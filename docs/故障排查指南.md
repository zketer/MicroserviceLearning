# SpringBoot + SpringCloud æ•…éšœæ’æŸ¥æŒ‡å—

## ğŸš¨ å¸¸è§å¯åŠ¨é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

### 1. ä¾èµ–è§£æå¤±è´¥

#### é—®é¢˜ç°è±¡
```
[ERROR] Failed to execute goal on project user-service: Could not resolve dependencies
[ERROR] dependency: com.study:common:jar:1.0.0 (compile)
[ERROR] com.study:common:jar:1.0.0 was not found in repository
```

#### æ ¹æœ¬åŸå› 
- Mavenå¤šæ¨¡å—é¡¹ç›®ä¸­ï¼Œå­æ¨¡å—ä¾èµ–çš„å…¬å…±æ¨¡å—æœªå®‰è£…åˆ°æœ¬åœ°ä»“åº“
- Mavenç¼“å­˜äº†å¤±è´¥çš„ä¾èµ–è§£æç»“æœ

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. æ¸…ç†å¹¶é‡æ–°å®‰è£…æ‰€æœ‰æ¨¡å—
mvn clean install -DskipTests

# 2. å¦‚æœé—®é¢˜æŒç»­ï¼Œæ¸…ç†æœ¬åœ°ä»“åº“ç¼“å­˜
mvn dependency:purge-local-repository

# 3. å¼ºåˆ¶æ›´æ–°ä¾èµ–
mvn clean install -U -DskipTests
```

#### é¢„é˜²æªæ–½
- æ¯æ¬¡ä¿®æ”¹å…¬å…±æ¨¡å—åï¼Œå…ˆæ‰§è¡Œ `mvn install`
- åœ¨CI/CDæµç¨‹ä¸­ç¡®ä¿æ¨¡å—æŒ‰æ­£ç¡®é¡ºåºæ„å»º

### 2. ç«¯å£å ç”¨é—®é¢˜

#### é—®é¢˜ç°è±¡
```
Web server failed to start. Port 8080 was already in use.
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :8080

# 2. æ€æ­»å ç”¨è¿›ç¨‹
kill -9 <PID>

# 3. æˆ–è€…ä½¿ç”¨åœæ­¢è„šæœ¬
./stop-services.sh

# 4. ä¿®æ”¹é…ç½®æ–‡ä»¶ä½¿ç”¨ä¸åŒç«¯å£
# application.yml
server:
  port: 8081
```

### 3. æ•°æ®åº“è¿æ¥å¤±è´¥

#### é—®é¢˜ç°è±¡
```
com.mysql.cj.jdbc.exceptions.CommunicationsException: Communications link failure
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
brew services list | grep mysql

# 2. å¯åŠ¨MySQLæœåŠ¡
brew services start mysql

# 3. éªŒè¯æ•°æ®åº“è¿æ¥
mysql -u root -p -h localhost -P 3306

# 4. æ£€æŸ¥æ•°æ®åº“æ˜¯å¦å­˜åœ¨
SHOW DATABASES;
USE springcloud_study;
```

#### é…ç½®æ£€æŸ¥
```yaml
# application.yml
spring:
  datasource:
    url: jdbc:mysql://localhost:3306/springcloud_study?useSSL=false&serverTimezone=Asia/Shanghai&characterEncoding=utf8
    username: root
    password: your_password
    driver-class-name: com.mysql.cj.jdbc.Driver
```

### 4. MyBatis Plusä¸Spring Boot 3.2.5å…¼å®¹æ€§é—®é¢˜

#### é—®é¢˜ç°è±¡
```
Invalid value type for attribute 'factoryBeanObjectType': java.lang.String
```

#### æ ¹æœ¬åŸå› 
- Spring Boot 3.2.xç‰ˆæœ¬å¯¹`FactoryBeanRegistrySupport.getTypeForFactoryBeanFromAttributes()`æ–¹æ³•è¿›è¡Œäº†æ›´æ”¹
- MyBatis Plusæ—§ç‰ˆæœ¬çš„starterä¸Spring Boot 3.2.xä¸å…¼å®¹

#### è§£å†³æ–¹æ¡ˆ
```xml
<!-- 1. æ›´æ–°MyBatis Plusç‰ˆæœ¬åˆ°3.5.7æˆ–æ›´é«˜ -->
<properties>
    <mybatis-plus.version>3.5.7</mybatis-plus.version>
</properties>

<!-- 2. ä½¿ç”¨ä¸“ä¸ºSpring Boot 3è®¾è®¡çš„starter -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-spring-boot3-starter</artifactId>
    <version>${mybatis-plus.version}</version>
</dependency>
```

#### é¢„é˜²æªæ–½
- å‡çº§Spring Bootç‰ˆæœ¬æ—¶ï¼Œæ£€æŸ¥æ‰€æœ‰ä¾èµ–çš„å…¼å®¹æ€§
- å…³æ³¨å®˜æ–¹æ–‡æ¡£ä¸­çš„å…¼å®¹æ€§è¯´æ˜
- ä½¿ç”¨ä¸“ä¸ºç‰¹å®šSpring Bootç‰ˆæœ¬è®¾è®¡çš„starter

### 5. Eurekaæ³¨å†Œå¤±è´¥

#### é—®é¢˜ç°è±¡
```
com.netflix.discovery.shared.transport.TransportException: Cannot execute request on any known server
```

#### è§£å†³æ–¹æ¡ˆ
```bash
# 1. ç¡®ä¿Eureka Serverå…ˆå¯åŠ¨
# 2. æ£€æŸ¥Eureka ServerçŠ¶æ€
curl http://localhost:8761/

# 3. æ£€æŸ¥å®¢æˆ·ç«¯é…ç½®
```

```yaml
# application.yml
eureka:
  client:
    service-url:
      defaultZone: http://localhost:8761/eureka/
    register-with-eureka: true
    fetch-registry: true
```

### 5. æœåŠ¡è°ƒç”¨è¶…æ—¶

#### é—®é¢˜ç°è±¡
```
feign.RetryableException: Read timed out executing GET
```

#### è§£å†³æ–¹æ¡ˆ
```yaml
# application.yml
feign:
  client:
    config:
      default:
        connectTimeout: 5000
        readTimeout: 10000
  hystrix:
    enabled: true

hystrix:
  command:
    default:
      execution:
        timeout:
          enabled: true
        isolation:
          thread:
            timeoutInMilliseconds: 10000
```

## ğŸ” ç³»ç»Ÿæ€§æ’æŸ¥æ–¹æ³•

### 1. å¯åŠ¨é¡ºåºæ£€æŸ¥

**æ­£ç¡®çš„å¯åŠ¨é¡ºåºï¼š**
1. **Eureka Server** (æ³¨å†Œä¸­å¿ƒ)
2. **é…ç½®ä¸­å¿ƒ** (å¦‚æœæœ‰)
3. **åŸºç¡€æœåŠ¡** (ç”¨æˆ·æœåŠ¡ã€è®¢å•æœåŠ¡ç­‰)
4. **ç½‘å…³æœåŠ¡** (æœ€åå¯åŠ¨)

### 2. æ—¥å¿—åˆ†ææ­¥éª¤

#### æŸ¥çœ‹å¯åŠ¨æ—¥å¿—
```bash
# æŸ¥çœ‹ç‰¹å®šæœåŠ¡çš„å¯åŠ¨æ—¥å¿—
tail -f logs/ç”¨æˆ·æœåŠ¡.log

# æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
grep -i error logs/ç”¨æˆ·æœåŠ¡.log

# æŸ¥çœ‹å¼‚å¸¸å †æ ˆ
grep -A 10 -B 5 "Exception" logs/ç”¨æˆ·æœåŠ¡.log
```

#### å…³é”®æ—¥å¿—å…³é”®è¯
- `Started Application` - æœåŠ¡å¯åŠ¨æˆåŠŸ
- `Tomcat started on port` - WebæœåŠ¡å™¨å¯åŠ¨
- `Registered instance` - æœåŠ¡æ³¨å†ŒæˆåŠŸ
- `DiscoveryClient` - æœåŠ¡å‘ç°ç›¸å…³
- `ERROR`, `WARN` - é”™è¯¯å’Œè­¦å‘Šä¿¡æ¯

### 3. ç½‘ç»œè¿é€šæ€§æ£€æŸ¥

```bash
# æ£€æŸ¥æœåŠ¡ç«¯å£æ˜¯å¦å¼€æ”¾
telnet localhost 8761
telnet localhost 8080
telnet localhost 8081
telnet localhost 8082

# æ£€æŸ¥HTTPæœåŠ¡å“åº”
curl -I http://localhost:8761/
curl -I http://localhost:8080/actuator/health
curl -I http://localhost:8081/actuator/health
```

### 4. é…ç½®éªŒè¯

#### æ£€æŸ¥é…ç½®æ–‡ä»¶
```bash
# éªŒè¯YAMLè¯­æ³•
python -c "import yaml; yaml.safe_load(open('application.yml'))"

# æ£€æŸ¥é…ç½®æ˜¯å¦ç”Ÿæ•ˆ
curl http://localhost:8081/actuator/configprops
```

## ğŸ›  æ•…éšœæ’æŸ¥å·¥å…·

### 1. ç³»ç»Ÿç›‘æ§å‘½ä»¤

```bash
# æŸ¥çœ‹Javaè¿›ç¨‹
jps -l

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tulpn | grep :8080
lsof -i :8080

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
top -p $(pgrep java)
free -h
df -h
```

### 2. Spring Boot Actuator

```yaml
# å¯ç”¨ç›‘æ§ç«¯ç‚¹
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,env,configprops,beans
  endpoint:
    health:
      show-details: always
```

**å¸¸ç”¨ç›‘æ§ç«¯ç‚¹ï¼š**
- `/actuator/health` - å¥åº·æ£€æŸ¥
- `/actuator/info` - åº”ç”¨ä¿¡æ¯
- `/actuator/env` - ç¯å¢ƒå˜é‡
- `/actuator/configprops` - é…ç½®å±æ€§
- `/actuator/beans` - Spring Beanä¿¡æ¯
- `/actuator/metrics` - åº”ç”¨æŒ‡æ ‡

### 3. æ—¥å¿—é…ç½®ä¼˜åŒ–

```yaml
# logback-spring.xml
logging:
  level:
    com.study: DEBUG
    org.springframework.cloud: DEBUG
    com.netflix.eureka: DEBUG
    com.netflix.discovery: DEBUG
  pattern:
    console: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%logger{50}] - %msg%n"
    file: "%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level [%logger{50}] - %msg%n"
  file:
    name: logs/application.log
    max-size: 100MB
    max-history: 30
```

## ğŸ“‹ æ•…éšœæ’æŸ¥æ¸…å•

### å¯åŠ¨å‰æ£€æŸ¥
- [ ] Javaç¯å¢ƒæ˜¯å¦æ­£ç¡® (`java -version`)
- [ ] Mavenç¯å¢ƒæ˜¯å¦æ­£ç¡® (`mvn -version`)
- [ ] MySQLæœåŠ¡æ˜¯å¦è¿è¡Œ
- [ ] ç«¯å£æ˜¯å¦è¢«å ç”¨
- [ ] é¡¹ç›®æ˜¯å¦ç¼–è¯‘æˆåŠŸ (`mvn clean compile`)

### å¯åŠ¨è¿‡ç¨‹æ£€æŸ¥
- [ ] Eureka Serveræ˜¯å¦å…ˆå¯åŠ¨
- [ ] å„æœåŠ¡æ˜¯å¦æŒ‰é¡ºåºå¯åŠ¨
- [ ] å¯åŠ¨æ—¥å¿—æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
- [ ] æœåŠ¡æ˜¯å¦æˆåŠŸæ³¨å†Œåˆ°Eureka

### å¯åŠ¨åéªŒè¯
- [ ] æ‰€æœ‰ç«¯å£æ˜¯å¦æ­£å¸¸ç›‘å¬
- [ ] Eurekaæ§åˆ¶å°æ˜¯å¦æ˜¾ç¤ºæ‰€æœ‰æœåŠ¡
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹æ˜¯å¦æ­£å¸¸
- [ ] æœåŠ¡é—´è°ƒç”¨æ˜¯å¦æ­£å¸¸

## ğŸš€ æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 1. JVMå‚æ•°ä¼˜åŒ–

```bash
# å¼€å‘ç¯å¢ƒ
export MAVEN_OPTS="-Xms256m -Xmx512m -XX:+UseG1GC"

# ç”Ÿäº§ç¯å¢ƒ
java -Xms1g -Xmx2g \
     -XX:+UseG1GC \
     -XX:MaxGCPauseMillis=200 \
     -XX:+HeapDumpOnOutOfMemoryError \
     -XX:HeapDumpPath=/logs/heapdump.hprof \
     -jar app.jar
```

### 2. å¯åŠ¨æ—¶é—´ä¼˜åŒ–

```yaml
# application.yml
spring:
  main:
    lazy-initialization: true  # å»¶è¿Ÿåˆå§‹åŒ–
  jpa:
    hibernate:
      ddl-auto: none  # ç¦ç”¨è‡ªåŠ¨DDL
  cloud:
    loadbalancer:
      cache:
        enabled: true  # å¯ç”¨è´Ÿè½½å‡è¡¡ç¼“å­˜
```

### 3. æ•°æ®åº“è¿æ¥æ± ä¼˜åŒ–

```yaml
spring:
  datasource:
    hikari:
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 300000
      max-lifetime: 1800000
      connection-timeout: 30000
```

## ğŸ“ ç´§æ€¥æ•…éšœå¤„ç†

### 1. æœåŠ¡å…¨éƒ¨åœæ­¢
```bash
# ä½¿ç”¨åœæ­¢è„šæœ¬
./stop-services.sh

# æ‰‹åŠ¨æ€æ­»æ‰€æœ‰Javaè¿›ç¨‹
pkill -f "spring-boot:run"

# æ¸…ç†ç«¯å£å ç”¨
lsof -ti:8080,8081,8082,8761 | xargs kill -9
```

### 2. å¿«é€Ÿé‡å¯
```bash
# åœæ­¢æ‰€æœ‰æœåŠ¡
./stop-services.sh

# æ¸…ç†ç¼–è¯‘ç¼“å­˜
mvn clean

# é‡æ–°å®‰è£…ä¾èµ–
mvn install -DskipTests

# é‡æ–°å¯åŠ¨
./start-services.sh
```

### 3. å›æ»šåˆ°ç¨³å®šç‰ˆæœ¬
```bash
# ä½¿ç”¨Gitå›æ»š
git stash
git checkout <stable-commit>

# é‡æ–°æ„å»ºå’Œå¯åŠ¨
mvn clean install -DskipTests
./start-services.sh
```

## ğŸ“š è¿›ä¸€æ­¥å­¦ä¹ èµ„æº

### å®˜æ–¹æ–‡æ¡£
- [Spring Bootæ•…éšœæ’æŸ¥](https://docs.spring.io/spring-boot/docs/current/reference/html/howto.html)
- [Spring Cloudæ•…éšœæ’æŸ¥](https://spring.io/projects/spring-cloud)
- [Eurekaæ•…éšœæ’æŸ¥](https://github.com/Netflix/eureka/wiki)

### ç›‘æ§å·¥å…·
- **Micrometer** - åº”ç”¨æŒ‡æ ‡æ”¶é›†
- **Zipkin** - åˆ†å¸ƒå¼é“¾è·¯è¿½è¸ª
- **Prometheus + Grafana** - ç›‘æ§å’Œå¯è§†åŒ–
- **ELK Stack** - æ—¥å¿—èšåˆå’Œåˆ†æ

### æœ€ä½³å®è·µ
- å»ºç«‹å®Œå–„çš„æ—¥å¿—è®°å½•æœºåˆ¶
- å®æ–½å¥åº·æ£€æŸ¥å’Œç›‘æ§
- åˆ¶å®šæ•…éšœåº”æ€¥é¢„æ¡ˆ
- å®šæœŸè¿›è¡Œæ•…éšœæ¼”ç»ƒ
- å»ºç«‹çŸ¥è¯†åº“å’Œæ–‡æ¡£

é€šè¿‡ç³»ç»Ÿæ€§çš„æ•…éšœæ’æŸ¥æ–¹æ³•å’Œå·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå®šä½å’Œè§£å†³å¾®æœåŠ¡æ¶æ„ä¸­çš„å„ç§é—®é¢˜ï¼Œç¡®ä¿ç³»ç»Ÿçš„ç¨³å®šè¿è¡Œã€‚